---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import PizzaCard from '../components/PizzaCard.astro';
import OrderModal from '../components/OrderModal.astro';
import { menu } from '../data/menu.js'; 
---

<Layout title="Roger Pizzas | Simplemente, la mejor">
  <Navbar />
  <OrderModal />
  
  <main class="bg-[#F9F8F6] text-zinc-800 pt-24 min-h-screen font-sans">
    
    <section id="hero" class="py-20 px-6 container mx-auto grid lg:grid-cols-2 gap-12 items-center">
      <div class="space-y-6">
        <h2 class="text-red-700 font-bold tracking-[0.3em] uppercase text-xs">Simplemente, la mejor pizza</h2>
        <h1 class="text-7xl md:text-8xl font-black italic uppercase leading-none tracking-tighter text-zinc-900">
          PIZZA <span class="text-red-600">BARRA</span>
        </h1>
        <div class="flex flex-col gap-2">
            <p class="text-xl text-zinc-500 font-medium border-l-4 border-red-600 pl-4 uppercase">12 Rebanadas | 2 Estaciones</p>
            <p class="text-red-600 font-black italic uppercase text-sm ml-5">Orilla rellena de queso</p>
        </div>
        
        <div class="flex items-center gap-6 pt-4">
          <span class="text-6xl font-black text-zinc-900 leading-none">$290</span>
          <div class="bg-red-50 border border-red-200 p-3 rounded-2xl">
            <p class="text-red-600 font-black text-lg uppercase leading-tight italic">¬°GRATIS!</p>
            <p class="text-zinc-600 text-[10px] font-bold uppercase tracking-widest">1 REFRESCO 2LTS</p>
          </div>
        </div>
      </div>
      <div class="relative">
        <div class="absolute -inset-4 bg-red-600/5 rounded-[4rem] rotate-3"></div>
        <img src="https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800" class="relative rounded-[3rem] shadow-2xl -rotate-2 object-cover h-[450px] w-full" alt="Pizza Barra" />
      </div>
    </section>

    <section class="py-6 bg-zinc-900 text-white font-medium text-center uppercase tracking-[0.2em] text-sm">
      Orilla rellena <span class="text-red-500 font-black italic">GRATIS</span> Martes y Jueves <span class="opacity-50 text-xs">(Med. y Gde.)</span>
    </section>

    <section id="especialidades" class="py-24 container mx-auto px-6">
      <div class="text-center mb-20">
        <span class="text-red-600 font-bold tracking-widest text-xs uppercase">Nuestro Men√∫</span>
        <h2 class="text-5xl md:text-6xl font-black italic uppercase text-zinc-900 mt-2">ESPECIALIDADES <span class="text-red-600">2X1</span></h2>
        <p class="text-zinc-400 font-medium uppercase tracking-widest text-[10px] mt-4">Aplica en pizzas redondas seleccionadas</p>
      </div>

      <div class="space-y-32">
        <div>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
            {menu.especialidades.pizzas.map((pizza) => (
              <PizzaCard 
                nombre={pizza.nombre} 
                ingredientes={pizza.ingredientes} 
                precios={menu.especialidades.precios}
                imagen="https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?q=80&w=600" 
              />
            ))}
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-10">
            {menu.tropical.pizzas.map((pizza) => (
              <PizzaCard 
                nombre={pizza.nombre} 
                ingredientes={pizza.ingredientes} 
                precios={menu.tropical.precios}
                imagen="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?q=80&w=600" 
              />
            ))}
            {menu.marinera.pizzas.map((pizza) => (
              <PizzaCard 
                nombre={pizza.nombre} 
                ingredientes={pizza.ingredientes} 
                precios={menu.marinera.precios}
                imagen="https://images.unsplash.com/photo-1555072956-7758afb20e8f?q=80&w=600" 
              />
            ))}
        </div>
      </div>
    </section>

    <section id="especiales-casa" class="py-24 bg-zinc-100/50 border-y border-zinc-200">
      <div class="container mx-auto px-6">
        <div class="text-center mb-16">
          <span class="text-red-600 font-bold tracking-[0.3em] uppercase text-xs">Tama√±os Familiares</span>
          <h2 class="text-5xl font-black italic uppercase text-zinc-900 mt-2">Especialidades de la Casa</h2>
          <p class="text-zinc-500 font-medium mt-4 italic">No aplica 2x1 | Incluyen <span class="text-zinc-900 font-bold">Refresco GRATIS</span></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          
          <div class="pizza-card bg-white rounded-[2.5rem] p-8 shadow-xl border border-zinc-100 flex flex-col justify-between hover:scale-[1.02] transition-all duration-300">
            <div>
              <div class="flex justify-between items-start mb-6">
                <h3 class="text-3xl font-black italic uppercase text-zinc-900 leading-none">Pizza<br/>Barra</h3>
                <span class="bg-zinc-900 text-white text-[9px] font-black px-3 py-1 rounded-full uppercase italic">12 Rebanadas</span>
              </div>
              <p class="text-zinc-400 text-[10px] font-bold uppercase tracking-widest mb-6 leading-tight">Orilla rellena de queso | 2 Estaciones</p>
              <div class="bg-red-50 p-4 rounded-2xl border border-red-100 mb-8 text-center">
                 <p class="text-red-600 font-black text-[10px] uppercase tracking-widest mb-1 italic">üéÅ GRATIS</p>
                 <p class="text-zinc-900 font-bold text-xs uppercase">1 Refresco 2 Lts</p>
              </div>
            </div>
            <div class="space-y-4">
              <label class="flex items-center justify-between p-4 bg-zinc-50 rounded-2xl border border-zinc-100 cursor-pointer">
                <span class="text-[10px] font-black uppercase text-zinc-400 italic">Precio</span>
                <input type="radio" name="promo-barra" value="Barra - $290" checked class="hidden peer" />
                <span class="text-3xl font-black text-zinc-900 italic">$290</span>
              </label>
              <button class="add-btn w-full bg-zinc-900 hover:bg-red-600 text-white font-black py-4 rounded-2xl transition-all uppercase italic text-[11px] tracking-widest shadow-lg active:scale-95">
                üõí A√±adir al pedido
              </button>
            </div>
          </div>

          <div class="pizza-card bg-white rounded-[2.5rem] p-8 shadow-xl border border-zinc-100 flex flex-col justify-between hover:scale-[1.02] transition-all duration-300">
            <div>
              <div class="flex justify-between items-start mb-6">
                <h3 class="text-3xl font-black italic uppercase text-zinc-900 leading-none">Pizza<br/>Cuadrada</h3>
                <span class="bg-zinc-900 text-white text-[9px] font-black px-3 py-1 rounded-full uppercase italic">16 Rebanadas</span>
              </div>
              <p class="text-zinc-400 text-[10px] font-bold uppercase tracking-widest mb-6 leading-tight">Orilla rellena de queso | 4 Estaciones</p>
              <div class="bg-red-50 p-4 rounded-2xl border border-red-100 mb-8 text-center">
                 <p class="text-red-600 font-black text-[10px] uppercase tracking-widest mb-1 italic">üéÅ GRATIS</p>
                 <p class="text-zinc-900 font-bold text-xs uppercase">1 Refresco 2 Lts</p>
              </div>
            </div>
            <div class="space-y-4">
              <label class="flex items-center justify-between p-4 bg-zinc-50 rounded-2xl border border-zinc-100 cursor-pointer">
                <span class="text-[10px] font-black uppercase text-zinc-400 italic">Precio</span>
                <input type="radio" name="promo-cuadrada" value="Cuadrada - $315" checked class="hidden peer" />
                <span class="text-3xl font-black text-zinc-900 italic">$315</span>
              </label>
              <button class="add-btn w-full bg-zinc-900 hover:bg-red-600 text-white font-black py-4 rounded-2xl transition-all uppercase italic text-[11px] tracking-widest shadow-lg active:scale-95">
                üõí A√±adir al pedido
              </button>
            </div>
          </div>

          <div class="pizza-card bg-white rounded-[2.5rem] p-8 shadow-xl border border-red-600/20 flex flex-col justify-between border-t-4 border-t-red-600 hover:scale-[1.02] transition-all duration-300">
            <div>
              <div class="flex justify-between items-start mb-6">
                <h3 class="text-3xl font-black italic uppercase text-zinc-900 leading-none">Pizza<br/>Rectangular</h3>
                <span class="bg-red-600 text-white text-[9px] font-black px-3 py-1 rounded-full uppercase italic">24 Rebanadas</span>
              </div>
              <p class="text-zinc-400 text-[10px] font-bold uppercase tracking-widest mb-6 leading-tight">Orilla rellena de queso | 4 Estaciones</p>
              <div class="bg-red-50 p-4 rounded-2xl border border-red-100 mb-8 text-center">
                 <p class="text-red-600 font-black text-[10px] uppercase tracking-widest mb-1 italic">üéÅ GRATIS</p>
                 <p class="text-zinc-900 font-bold text-xs uppercase">1 Refresco 2.5 Lts</p>
              </div>
            </div>
            <div class="space-y-4">
              <label class="flex items-center justify-between p-4 bg-zinc-50 rounded-2xl border border-zinc-100 cursor-pointer">
                <span class="text-[10px] font-black uppercase text-zinc-400 italic">Precio</span>
                <input type="radio" name="promo-rectangular" value="Rectangular - $395" checked class="hidden peer" />
                <span class="text-3xl font-black text-zinc-900 italic">$395</span>
              </label>
              <button class="add-btn w-full bg-red-600 hover:bg-zinc-900 text-white font-black py-4 rounded-2xl transition-all uppercase italic text-[11px] tracking-widest shadow-lg active:scale-95">
                üõí A√±adir al pedido
              </button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <footer id="contacto" class="bg-white border-t border-zinc-200 text-zinc-900 py-24 px-6 mt-20">
      <div class="container mx-auto grid md:grid-cols-2 gap-16">
        <div class="space-y-8">
          <h2 class="text-5xl font-black tracking-tighter italic uppercase">Roger<br/><span class="text-red-600">Pizzas</span></h2>
          <p class="text-zinc-500 font-medium max-w-xs uppercase text-xs leading-loose tracking-widest">
            Calle San Jose, Col. La Hacienda, Jalapilla Veracruz
          </p>
        </div>
        <div class="flex flex-col justify-end space-y-6 text-right">
          <p class="text-4xl font-light tracking-tighter italic">272-688-5145</p>
          <a href="https://wa.me/2721318273" class="text-red-600 text-2xl font-black uppercase italic hover:text-red-700 transition-colors">WhatsApp: 272-131-8273</a>
          <p class="text-xs font-bold text-zinc-400 tracking-[0.3em] uppercase">Horario: 11:00 AM - 10:00 PM</p>
        </div>
      </div>
    </footer>
  </main>
</Layout>

<script>
  declare global {
    interface Window {
      cart: any[];
    }
  }

  let cart: any[] = [];
  window.cart = cart;

  function updateCartUI() {
    const counter = document.getElementById('cart-counter');
    const counterContainer = document.getElementById('cart-counter-container');
    
    if (counter && counterContainer) {
      counter.innerText = cart.length.toString();
      counterContainer.classList.toggle('hidden', cart.length === 0);
    }
  }

  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const addButton = target.closest('.add-btn');
    
    if (addButton) {
      const card = addButton.closest('.pizza-card');
      const nombreElt = card?.querySelector('h3') as HTMLElement;
      const nombre = nombreElt.innerText;
      const selectedRadio = card?.querySelector('input[type="radio"]:checked') as HTMLInputElement;
      
      if (!selectedRadio) {
        alert('‚ö†Ô∏è Por favor, selecciona un tama√±o antes de a√±adir.');
        return;
      }

      const [tam, precioStr] = selectedRadio.value.split(' - ');
      const precio = parseInt(precioStr.replace('$', ''));
      
      cart.push({ nombre, tam, precio });
      
      const originalContent = addButton.innerHTML;
      addButton.classList.add('!bg-zinc-900', '!text-white');
      addButton.innerHTML = '‚úì Agregado';
      
      setTimeout(() => {
        addButton.classList.remove('!bg-zinc-900', '!text-white');
        addButton.innerHTML = originalContent;
      }, 1000);

      updateCartUI();
    }
  });

  document.getElementById('open-cart')?.addEventListener('click', () => {
    if (cart.length === 0) {
      alert('Tu carrito est√° vac√≠o. ¬°Elige una pizza primero! üçï');
      return;
    }
    
    const modal = document.getElementById('order-modal');
    const itemsList = document.getElementById('cart-items-list');
    const priceDisplay = document.getElementById('pizza-price');

    if (itemsList) {
      itemsList.innerHTML = cart.map(item => `
        <div class="flex justify-between items-center bg-zinc-50 p-3 rounded-xl border border-zinc-100">
          <div>
            <p class="font-bold text-zinc-900 text-xs uppercase italic">${item.nombre}</p>
            <p class="text-[9px] text-zinc-400 font-bold uppercase">${item.tam}</p>
          </div>
          <p class="font-black text-zinc-900">$${item.precio}</p>
        </div>
      `).join('');
    }

    if (priceDisplay) {
      const total = cart.reduce((acc, curr) => acc + curr.precio, 0);
      priceDisplay.innerText = `$${total}`;
    }
    
    modal?.classList.remove('hidden');
  });
</script>